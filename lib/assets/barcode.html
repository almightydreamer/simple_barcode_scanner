<!DOCTYPE html>
<html lang="en">
<head>
    <title>QR Code Scanner</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* Ensure canvas and reader are positioned correctly */
        canvas.drawing, canvas.drawingBuffer {
            position: absolute;
            left: 0;
            top: 0;
        }

        html, body {
            height: 100%;   /* Stretch to 100% of the viewport */
            margin: 0;      /* Remove any margins */
            padding: 0;     /* Remove any padding */
            overflow: hidden; /* Prevent scrolling */
            display: flex;
            justify-content: center;  /* Center horizontally */
            align-items: center;      /* Center vertically */
        }

        #reader {
            width: 100vw;   /* Full width of viewport */
            height: 100vh;  /* Full height of viewport */
            position: relative;
        }
    </style>
    <script src="html5-qrcode.min.js"></script>
</head>
<body>
<!-- Div to show the scanner -->
<div id="reader"></div>

<script>
        const html5QrCode = new Html5Qrcode("reader");
        console.log("Starting QR Code Scanner");

        const qrCodeSuccessCallback = (decodedText, decodedResult) => {
            console.log(`Decoded Text: ${decodedText}`);
            html5QrCode.stop();
            // Handle success for web
            window.parent.postMessage(decodedText, "*");

            // Handle success for WebView (if applicable)
            if (window.chrome.webview !== undefined) {
                const param = { methodName: "successCallback", data: decodedText };
                window.chrome.webview.postMessage(param);
            }
        };

        const config = {
            fps: 10,
            qrbox: { width: 380, height: 220, aspectRatio: 2.7777778 }
        };

        // Start QR scanner with back camera by default
        html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback)
            .catch(err => console.error("QR Scanner failed to start", err));

        // Stop scanner on WebView event (if applicable)
        if (window.chrome.webview !== undefined) {
            window.chrome.webview.addEventListener('message', (e) => {
                const data = JSON.parse(JSON.stringify(e.data));
                if (data.event === "close") {
                    html5QrCode.stop();
                }
            });
        }
    </script>
</body>
</html>
